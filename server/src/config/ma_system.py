"""
均线系统配置常量

定义均线系统强度计算引擎的所有配置参数。
"""

from typing import Dict, List, Tuple

# =============================================================================
# 均线周期配置
# =============================================================================

MA_PERIODS = [5, 10, 20, 30, 60, 90, 120, 240]

# =============================================================================
# 数据要求配置
# =============================================================================

# 最小数据天数要求
MIN_DATA_DAYS = 5  # 至少需要5天数据才能计算MA5
FULL_DATA_DAYS = 240  # 完整数据需要240天（计算MA240）

# 均线权重配置
MA_WEIGHTS: Dict[int, float] = {
    5: 0.15,   # MA5
    10: 0.15,  # MA10
    20: 0.18,  # MA20
    30: 0.15,  # MA30
    60: 0.15,  # MA60
    90: 0.10,  # MA90
    120: 0.07, # MA120
    240: 0.05  # MA240
}

# 短中长期分组
TERM_GROUPS: Dict[str, List[int]] = {
    'short': [5, 10, 20],
    'medium': [30, 60],
    'long': [90, 120, 240]
}

# =============================================================================
# 强度等级定义
# =============================================================================

STRENGTH_GRADES: Dict[str, Tuple[int, int, str]] = {
    "S+": (90, 100, "极强"),
    "S": (85, 89, "很强"),
    "A+": (75, 84, "强"),
    "A": (65, 74, "偏强"),
    "B+": (55, 64, "中性偏强"),
    "B": (45, 54, "中性"),
    "C+": (35, 44, "中性偏弱"),
    "C": (25, 34, "偏弱"),
    "D+": (15, 24, "弱"),
    "D": (0, 14, "很弱"),
}

# =============================================================================
# 均线排列状态定义
# =============================================================================

MA_ALIGNMENT_STATES = {
    "perfect_bull": "完美多头",
    "strong_bull": "强势多头",
    "bull": "多头",
    "neutral": "中性",
    "bear": "空头",
    "perfect_bear": "完美空头",
}

# =============================================================================
# 辅助函数
# =============================================================================

def get_strength_grade(score: float) -> str:
    """
    根据得分获取强度等级

    Args:
        score: 强度得分 (0-100)

    Returns:
        强度等级代码 (如 "S+", "A", "D" 等)
    """
    if score is None:
        return "D"

    for grade, (min_score, max_score, _) in STRENGTH_GRADES.items():
        if min_score <= score <= max_score:
            return grade
    return "D"


def get_strength_grade_name(grade: str) -> str:
    """
    获取强度等级中文名称

    Args:
        grade: 强度等级代码

    Returns:
        中文名称
    """
    return STRENGTH_GRADES.get(grade, (0, 0, "未知"))[2]


def get_ma_alignment_state_name(state: str) -> str:
    """
    获取均线排列状态中文名称

    Args:
        state: 排列状态代码

    Returns:
        中文名称
    """
    return MA_ALIGNMENT_STATES.get(state, "未知")


def get_available_periods(max_days: int) -> List[int]:
    """
    根据可用天数获取可计算的均线周期

    Args:
        max_days: 最大可用天数

    Returns:
        可计算的周期列表
    """
    return [period for period in MA_PERIODS if period <= max_days]
