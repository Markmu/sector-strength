---
stepsCompleted: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
inputDocuments: []
workflowType: 'prd'
lastStep: 10
project_name: 'sector-strenth'
user_name: 'Mark'
date: '2025-12-24'
prd_version: '1.4'
---

# 股票市场板块强弱指标系统产品需求文档 (PRD)

**Author:** Mark
**Date:** 2025-12-24

## 执行摘要

### 产品愿景

股票市场板块强弱指标系统是一个面向中国股市投资者的量化分析工具，通过多周期均线（5、10、20、30、60天）计算板块和个股的综合强度得分，提供实时可视化数据。系统帮助投资者识别新兴趋势、监控板块轮动，并做出数据驱动的投资决策。

### 核心价值

- **数据驱动决策**：通过量化指标替代主观判断
- **快速识别机会**：热力图和排名列表让强势板块一目了然
- **多维度分析**：板块级 + 个股级的双重分析视角
- **灵活的数据管理**：管理员可随时初始化、补齐和修正历史数据

### 目标用户

- 主要用户：关注中国股市的个人投资者和交易员
- 管理用户：系统管理员（负责数据维护和管理）

### What Makes This Special

1. **板块轮动洞察**：与传统关注个股的工具不同，本系统聚焦板块级别的强弱分析，帮助用户把握市场轮动节奏

2. **简化的管理员数据操作**：提供直观的管理员界面，支持按日期补齐数据、按时间段拉取历史数据、以及数据覆盖功能，让数据维护变得简单

3. **轻量级架构**：采用最简依赖设计，仅使用 PostgreSQL + 后台线程轮询，无需 Redis 或独立 Worker 容器，降低运维复杂度

4. **多周期综合评分**：融合多个时间维度的强度指标，提供更全面的市场视角

## 项目分类

**技术类型：** Web 应用
**领域：** 金融科技
**复杂度：** 高

### 分类依据

- **Web 应用**：基于浏览器的仪表板界面，使用 Next.js 框架，支持响应式设计
- **金融科技**：涉及股票市场数据、投资分析工具，需关注数据准确性和实时性
- **高复杂度**：金融领域需要严格的数据验证、错误处理，以及管理员数据管理功能

### 架构特点

- 单体 Monorepo 结构
- 前后端分离（Next.js + FastAPI）
- 单容器部署（后台线程处理异步任务）
- 最小依赖：仅 PostgreSQL 作为外部存储

---

## Success Criteria

### User Success

**核心价值实现：**
- 用户能够在 **5分钟内** 完成当日市场板块强弱分析（相比传统手动分析节省 80% 时间）
- 用户识别强势板块的准确率提升 **30%**（基于数据对比）
- 用户对数据可视化清晰度的满意度 > **85%**

**关键使用场景成功：**
- 每日市场概览：用户在收盘后 **10分钟内** 获取完整的板块强弱数据
- 板块轮动识别：用户能够准确识别资金流向的板块变化趋势
- 个股筛选：用户能够快速找出强势板块中的龙头个股

**管理员用户成功：**
- 管理员能够在 **5分钟内** 完成数据补齐操作（每日收盘后）
- 数据初始化任务成功率 > **95%**
- 管理员能够清晰监控任务进度和状态

### Business Success

**短期目标（3个月）：**
- 系统稳定运行，数据准确率达到 **99%**
- 支持 **10+** 并发用户同时访问
- 数据更新延迟控制在 **15分钟** 内

**中期目标（12个月）：**
- 板块强度预测与市场实际走势相关性 > **0.7**
- 用户持续使用率（周活跃/月活跃）> **60%**
- 数据覆盖范围扩展到全市场板块和股票

**业务健康度指标：**
- 系统可用性 > **99%**
- 数据异常自动检测和告警覆盖率 = **100%**
- 用户反馈问题响应时间 < **24小时**

### Technical Success

**性能指标：**
- 首页加载时间 < **2秒**（2秒规则）
- 热力图渲染时间 < **1秒**
- API 响应时间（p95）< **200ms**
- 数据库查询优化，支持 **10000+** 股票数据秒级检索

**可靠性指标：**
- 系统可用性 > **99.5%**
- 数据初始化任务失败率 < **5%**
- 自动重试机制覆盖率 = **100%**

**可维护性指标：**
- 单容器部署成功（无 Redis、无独立 Worker）
- 新功能开发周期 < **2周**
- 部署时间 < **10分钟**

**安全性指标：**
- 管理员功能权限隔离 = **100%**
- 操作审计日志完整性 = **100%**
- 用户数据加密存储

### Measurable Outcomes

| 指标类别 | 具体指标 | 目标值 | 测量方式 |
|---------|---------|-------|---------|
| 用户体验 | 首页加载时间 | < 2秒 | 性能监控 |
| 用户体验 | 数据更新延迟 | < 15分钟 | 系统日志 |
| 数据质量 | 数据准确率 | > 99% | 人工抽样验证 |
| 系统可靠性 | 可用性 | > 99.5% | 运维监控 |
| 系统可靠性 | 任务成功率 | > 95% | 任务日志 |
| 管理效率 | 数据补齐时间 | < 5分钟 | 操作日志 |
| 业务价值 | 用户周活率 | > 60% | 用户行为分析 |

## Product Scope

### MVP - Minimum Viable Product

**核心功能（必须实现）：**
1. 用户注册和登录
2. 板块强度热力图可视化
3. 板块和个股强度排名列表
4. 基础筛选功能（按板块类型、行业）
5. 管理员控制台：
   - 板块/股票数据初始化
   - 按日期补齐数据
   - 任务进度监控

**数据范围：**
- 主要行业板块（10-15个）
- 每个板块的成分股（前 50 只）
- 历史数据回溯：**60天**

**技术范围：**
- 单容器部署
- 基于数据库的异步任务
- PostgreSQL 持久化
- Next.js + FastAPI 基础架构

### Growth Features (Post-MVP)

**增强功能（MVP 后）：**
1. 用户关注列表和个性化推荐
2. 板块详情页（成分股分析、趋势图）
3. 个股详情页（多周期强度明细）
4. 历史趋势图表
5. 高级筛选（自定义条件组合）
6. 邮件/消息提醒功能

**数据扩展：**
- 全市场板块覆盖
- 全 A 股股票覆盖
- 历史数据回溯扩展到 **1年**

**技术增强：**
- 数据缓存优化
- 实时数据推送
- 移动端优化

### Vision (Future)

**未来愿景：**
1. AI 驱动的板块轮动预测
2. 量化回测功能
3. 策略构建和模拟交易
4. 社区分享和讨论功能
5. 移动 APP
6. API 开放平台

**数据愿景：**
- 多市场数据支持（港股、美股）
- 更多技术指标集成
- 另类数据（新闻、情绪等）

---

## User Journeys

### Journey 1: 李明 - 发现板块轮动的个人投资者

**背景故事：**
李明是一名 35 岁的软件工程师，业余时间投资 A 股已有 3 年。他习惯分析个股，但总是感觉错过了板块轮动的节奏——当他发现某个板块强势时，往往已经涨了一波。他渴望找到一个工具能帮助他更早地发现板块机会。

**旅程叙事：**
一个周五的晚上，李明在投资论坛上看到有人在讨论"板块强弱分析"，好奇心驱使他搜索相关工具，最终发现了这个板块强弱指标系统。他决定注册试用。

第二天早上，李明登录系统，立刻被首页的板块热力图吸引——红色代表强势，绿色代表弱势，市场格局一目了然。他注意到"新能源"板块呈现深红色，强度得分 8.5/10。点击进入详情页，他看到这个板块的成分股排名，龙头股清晰可见。

突破时刻来临：周一开盘，新能源板块果然领涨，李明在开盘时就关注了板块内的一只龙头股。当天该股上涨 7%，而如果按照他以往的方法，可能要收盘后才注意到。三个月后，李明形成了新的投资习惯——每天收盘后花 5 分钟查看板块强弱，他的投资收益率相比之前提升了 20%。

**关键触点：**
- 注册登录 → 首页热力图 → 板块详情 → 成分股排名
- 情感状态：好奇 → 惊喜 → 信任 → 习惯

**需求揭示：**
- 清晰的视觉化界面（热力图）
- 快速的板块对比能力
- 成分股快速访问
- 每日数据更新及时

### Journey 2: 张伟 - 追求效率的日内交易员

**背景故事：**
张伟是一名全职日内交易员，每天需要快速分析市场并做出决策。他过去依赖多个财经网站切换查看板块数据，耗时且信息分散。他需要一个能快速获取完整市场概览的工具。

**旅程叙事：**
上午 9:25，集合竞价刚结束，张伟打开系统查看最新的板块强弱数据。首页仪表板显示强势 TOP5 板块，他注意到"半导体"板块跃居榜首。通过筛选功能，他只看科技类板块，快速锁定目标。

盘中 10:30，张伟观察到半导体板块涨幅已达 3%，与系统早上的强度预测一致。他果断买入龙头股。下午 2:00，系统数据显示板块强度开始下降，他选择止盈离场。全天操作行云流水，效率提升显著。

但有一天，系统数据延迟了 15 分钟，张伟差点错过最佳入场点。他立即反馈给管理员，问题在次日得到修复。这次经历让他更加信任系统的可靠性。

**关键触点：**
- 快速加载首页 → 筛选特定板块 → 实时数据监控 → 反馈问题
- 情感状态：高效 → 焦虑（数据延迟）→ 满意（问题解决）

**需求揭示：**
- 极快的页面加载速度
- 数据实时性和准确性
- 高效的筛选功能
- 问题反馈机制

### Journey 3: 王芳 - 首次部署系统的管理员

**背景故事：**
王芳是某小型投资机构的 IT 负责人，负责内部投研工具的维护。公司决定引入这个板块强弱分析系统，她需要完成首次部署和数据初始化。

**旅程叙事：**
周一上午，王芳按照文档完成了 Docker Compose 部署，三个容器（frontend, backend, postgres）成功启动。她登录管理员控制台，看到空空如也的数据——系统需要初始化。

她点击"板块数据初始化"，设置回溯时间为 60 天，点击"开始任务"。页面显示进度条：0% → 15% → 40% → 100%。任务完成！系统显示"成功拉取 15 个板块、750 只股票的历史数据"。

然而，在初始化股票数据时，任务进行到 30% 就失败了。王芳查看任务日志，发现是 AkShare API 限流导致。她调整任务参数，添加重试机制，再次执行。这次任务顺利完成。

一周后，王芳建立了每日收盘后自动补齐数据的习惯。她每天下午 3:05 登录系统，点击"按日期补齐"，选择当天日期，5 分钟内完成数据更新。

**关键触点：**
- 系统部署 → 管理员登录 → 数据初始化 → 任务失败 → 参数调整 → 成功 → 日常维护
- 情感状态：紧张 → 挫败 → 问题解决 → 自信

**需求揭示：**
- 简单的部署流程
- 清晰的进度显示
- 详细的错误日志
- 任务重试机制
- 快速的数据补齐功能

### Journey 4: 陈刚 - 处理数据异常的管理员

**背景故事：**
陈刚是系统的兼职管理员，负责日常数据维护。某天他发现某只股票的数据异常——强度得分异常高，明显是数据源问题。

**旅程叙事：**
周三上午，用户反馈某只股票数据异常。陈刚登录管理员控制台，进入任务监控面板，查看最近的数据更新日志。他发现是 AkShare 返回了错误数据。

陈刚决定重新拉取这只股票的数据。他点击"按时间段拉取"，选择该股票代码和最近 7 天的时间范围，勾选"覆盖已有数据"。任务启动后，他看到实时进度：正在从 AkShare 获取数据 → 数据清洗 → 强度计算 → 存储到数据库。

10 分钟后，任务成功完成。陈刚刷新前端页面，异常数据已被修正。他检查操作审计日志，所有操作都被完整记录。

**关键触点：**
- 问题发现 → 查看日志 → 数据覆盖操作 → 任务监控 → 问题解决 → 审计确认
- 情感状态：担忧 → 专注 → 宽慰

**需求揭示：**
- 数据异常检测机制
- 按时间段覆盖功能
- 实时任务监控
- 操作审计日志
- 数据回滚能力

### Journey 5: 赵敏 - 新用户注册与首次使用

**背景故事：**
赵敏是一名刚入市的新手投资者，对板块分析一无所知。她经朋友推荐注册了这个系统。

**旅程叙事：**
赵敏点击注册链接，填写用户名和密码，收到验证邮件后完成激活。首次登录时，她看到简洁的首页界面，但不太理解板块强弱是什么意思。

她点击页面右上角的"帮助"按钮，弹出简短的教程："板块强度反映该板块内股票的整体走势，红色代表强势，绿色代表弱势"。赵敏豁然开朗。

她开始探索：点击热力图上的"医药"板块，看到成分股列表；点击某只股票，看到多周期强度明细（5日、10日、20日、30日、60日）。虽然数据很多，但她能看懂颜色编码——红色越多表示越强势。

一周后，赵敏形成了每天看盘前查看板块强弱的习惯。她感觉自己从"盲目跟风"变成了"有据可依"。

**关键触点：**
- 注册 → 邮箱验证 → 首次登录 → 帮助教程 → 探索功能 → 形成习惯
- 情感状态：困惑 → 顿悟 → 兴奋 → 自信

**需求揭示：**
- 简单的注册流程
- 新手引导/帮助文档
- 直观的视觉编码
- 清晰的数据展示

### Journey Requirements Summary

基于以上用户旅程，系统需要支持以下核心能力：

**普通投资者能力：**
1. 用户注册和身份验证
2. 板块热力图可视化（颜色编码）
3. 板块详情页（成分股分析）
4. 个股详情页（多周期强度明细）
5. 筛选功能（按板块类型、行业）
6. 实时/准实时数据更新
7. 帮助文档和新手引导

**管理员能力：**
1. 管理员角色和权限控制
2. 数据初始化功能（板块、股票，自定义回溯时间）
3. 按日期补齐数据
4. 按时间段拉取数据并覆盖
5. 异步任务执行和实时进度显示
6. 任务状态监控和日志查看
7. 操作审计日志
8. 任务失败重试机制

**系统级能力：**
1. 高性能页面加载（< 2秒）
2. 数据准确性和异常处理
3. 用户反馈机制
4. 系统部署文档

---

## Domain-Specific Requirements

### 金融科技合规与责任概览

本系统作为股票市场分析工具，虽不提供投资建议，但所提供的分析数据可能影响用户投资决策。因此需要在产品设计和实现中明确责任边界，确保内容合规，降低法律和运营风险。

### 核心领域关注点

**1. 数据准确性责任界定**
- 明确系统定位为"分析工具"而非"投资建议"
- 建立数据质量保证机制
- 实施免责声明和风险提示

**2. 内容合规性**
- 避免提供具体投资建议
- 明确数据来源和时效性
- 实施适当的风险提示

### 合规要求

**免责声明要求：**

系统必须在以下位置显示免责声明：
1. **注册页面** - 用户首次注册时必须确认已阅读风险提示
2. **首页底部** - 固定显示免责声明链接
3. **每个数据展示页面** - 标注"数据仅供参考，不构成投资建议"

**免责声明内容应包含：**
- 数据来源于第三方（AkShare），系统不对数据准确性负责
- 历史表现不代表未来收益
- 投资有风险，入市需谨慎
- 本系统仅提供分析工具，不构成投资建议
- 用户因使用本系统而产生的任何损失，系统不承担责任

**数据来源标注：**

所有数据页面必须标注：
- 数据来源：AkShare
- 数据更新时间
- 数据时效性说明（如：数据可能存在延迟）

### 内容合规规范

**系统定位：**
- 系统定位为"数据分析工具"，而非"投资咨询平台"
- 提供的是"客观数据可视化"，而非"主观投资建议"

**禁止内容：**
- 不推荐具体买入/卖出操作
- 不预测具体股价涨跌
- 不提供投资组合建议
- 不保证投资收益

**允许内容：**
- 提供历史数据分析
- 展示板块和股票的强度排名
- 呈现多周期技术指标
- 提供数据筛选和对比功能

**风险提示：**
在每个数据展示页面顶部显示：
> ⚠️ **风险提示**：本页面数据仅供参考，不构成任何投资建议。投资有风险，入市需谨慎。请根据自身风险承受能力独立做出投资决策。

### 数据质量保证

**数据验证机制：**
1. **源数据验证**
   - 从 AkShare 获取数据后，进行基本有效性检查（如价格范围、涨跌幅合理性）
   - 异常数据自动标记并记录到日志

2. **数据更新监控**
   - 记录每次数据更新的时间戳
   - 如果数据超过预设时间未更新，显示"数据可能过时"警告

3. **用户反馈通道**
   - 提供"数据反馈"按钮，允许用户报告异常数据
   - 管理员可在后台查看并处理反馈

**管理员数据修正流程：**
- 管理员发现数据异常后，可使用"按时间段覆盖"功能重新拉取数据
- 所有覆盖操作必须记录到审计日志，包括操作人、时间、原因
- 重要数据的修正应考虑数据备份和回滚机制

### 行业标准与最佳实践

**参考标准：**
- 中国证监会相关规定
- 《证券期货投资者适当性管理办法》
- 网络安全法和个人信息保护法

**最佳实践：**
1. **用户教育**：在帮助文档中说明如何正确理解和使用数据
2. **透明度**：清晰说明数据计算方法和局限性
3. **谨慎措辞**：避免使用绝对化、保证性的表述
4. **定期审查**：定期检查内容和声明是否符合最新监管要求

### 必需的专业知识与验证

**团队需要：**
- 了解金融监管合规要求
- 理解证券投资分析的基本原则
- 具备风险管理和法律合规意识

**验证要求：**
1. **法律审查**：在产品上线前，建议由法律专业人士审查免责声明和风险提示内容
2. **内容审查**：建立内容审查流程，确保所有页面文案符合合规要求
3. **定期合规检查**：每半年检查一次合规性，确保符合最新监管要求

### 实施考虑

**对功能需求的影响：**
- **FR1-FR8**：所有数据展示页面需要添加风险提示和数据来源标注
- **AFR**：管理员数据修正功能需要完整的审计日志

**对非功能需求的影响：**
- **NFR4**：数据准确性验证机制需要明确的技术实现
- **NFR6**：审计日志必须包含所有数据修改操作

**对用户界面设计的影响：**
- 每个页面需要预留风险提示区域
- 注册流程需要增加免责声明确认步骤
- 帮助文档需要包含数据使用说明和风险提示

**对开发顺序的影响：**
1. **P0（必须）**：免责声明和风险提示 UI
2. **P0（必须）**：数据来源标注
3. **P1（重要）**：数据验证机制
4. **P1（重要）**：审计日志完善
5. **P2（建议）**：用户反馈通道

---

## Web Application Specific Requirements

### Project-Type Overview

本系统采用单页应用（SPA）架构，使用 Next.js 框架构建前端，配合 FastAPI 后端服务。应用专注于数据可视化和分析工具，无需 SEO 优化，定位为内部使用的专业分析工具。

### Technical Architecture Considerations

**SPA 架构优势：**
- 快速的用户体验，页面切换无需重新加载
- 前后端分离，API 独立演进
- 更流畅的交互体验（热力图、筛选等）

**技术栈选择：**
- **前端框架**：Next.js（支持 SSR 和 CSR，为未来扩展保留灵活性）
- **状态管理**：React Query 或 SWR 用于数据缓存和同步
- **UI 组件**：shadcn/ui 或类似组件库，确保一致性
- **图表库**：Recharts 或 ECharts 用于热力图和趋势图

### Browser Support Matrix

| 浏览器 | 最低版本 | 支持级别 | 说明 |
|--------|---------|---------|------|
| Chrome | 90+ | 完全支持 | 主要目标浏览器 |
| Edge | 90+ | 完全支持 | 基于 Chromium，兼容 |
| 其他 | 不支持 | - | Firefox、Safari 等 |

**兼容性策略：**
- 仅针对 Chrome/Edge 进行开发和测试
- 使用现代 JavaScript 特性（ES2020+）
- 使用 CSS Grid、Flexbox 等现代布局
- 不需要 polyfill 或兼容性处理

### Responsive Design Requirements

**目标设备：**
- **桌面**：1920x1080（主要目标）
- **笔记本**：1366x768
- **平板**：1024x768（iPad 横屏）
- **手机**：375x667（iPhone SE，基础支持）

**响应式断点：**
```css
/* 移动设备 */
@media (max-width: 640px) { ... }

/* 平板设备 */
@media (min-width: 641px) and (max-width: 1024px) { ... }

/* 桌面设备 */
@media (min-width: 1025px) { ... }
```

**布局适配：**
- 桌面：热力图 + 侧边栏 + 详情面板的三栏布局
- 平板：热力图 + 折叠侧边栏
- 手机：单列布局，热力图垂直滚动

### Performance Targets

**加载性能：**
| 指标 | 目标值 | 测量方式 |
|------|--------|----------|
| 首屏加载（FCP） | < 1.5秒 | Lighthouse |
| 可交互时间（TTI） | < 3秒 | Lighthouse |
| 路由切换 | < 500ms | Performance API |
| API 响应（p95） | < 200ms | 后端监控 |

**渲染性能：**
- 热力图渲染：100 个区块 < 500ms
- 表格渲染：1000 行数据 < 1秒
- 图表重绘：< 100ms

**优化策略：**
- 代码分割（Code Splitting）：按路由分割代码
- 懒加载（Lazy Loading）：图表组件按需加载
- 数据分页：列表数据分页加载（每页 50 条）
- 图片优化：使用 Next.js Image 组件
- 缓存策略：API 响应缓存 5 分钟

### SEO Strategy

**SEO 策略：不需要 SEO**

**理由：**
- 系统为内部使用工具，需要登录访问
- 数据仅供注册用户查看
- 不需要搜索引擎收录

**技术实现：**
- 使用 SPA 模式，不启用 SSR
- robots.txt：Disallow 所有爬虫
- 不添加 meta 标签优化
- 不生成 sitemap

**如果未来需要公开部分内容：**
- 可以启用 Next.js SSR 模式
- 添加必要的 meta 标签
- 生成动态 sitemap

### Accessibility Level

**可访问性：无特殊要求**

**标准做法：**
- 遵循基本的 Web 可用性原则
- 确保颜色对比度可接受（避免纯红/纯绿）
- 提供键盘导航支持（基本）
- 不需要符合 WCAG 标准

**最小化实现：**
- 语义化 HTML（使用正确的标签）
- 表单元素有 label
- 错误提示清晰可见
- 不需要屏幕阅读器支持

### Data Refresh Strategy

**刷新机制：**
- **自动刷新**：每 5 分钟自动刷新数据
- **手动刷新**：用户可点击刷新按钮
- **智能刷新**：仅在数据更新时重新获取

**实现方式：**
```typescript
// 使用 React Query 的自动刷新
const { data } = useQuery({
  queryKey: ['sector-strength'],
  queryFn: fetchSectorStrength,
  refetchInterval: 5 * 60 * 1000, // 5 分钟
  staleTime: 60 * 1000, // 1 分钟内认为数据新鲜
})
```

**数据时效性提示：**
- 显示"最后更新时间"
- 数据超过 10 分钟未更新，显示警告提示
- 数据加载中显示骨架屏（Skeleton）

### Implementation Considerations

**PWA 支持（可选）：**
- 不需要 PWA 功能（离线支持、安装提示）
- 如果未来需要，可以添加 Service Worker

**浏览器特性使用：**
- **LocalStorage**：存储用户偏好（筛选条件、排序）
- **SessionStorage**：临时数据（当前页面状态）
- **IndexedDB**：不需要（数据都在服务器）
- **Web Workers**：如果需要大量计算，考虑使用

**错误处理：**
- API 错误：友好提示，重试按钮
- 网络错误：检测并提示用户检查网络
- 数据异常：显示占位符或空状态
- 错误边界（Error Boundary）：捕获 React 错误

**监控和分析：**
- 性能监控：Web Vitals（CLS, FID, LCP）
- 错误监控：前端错误上报
- 用户行为：不需要（内部工具）

**开发工具：**
- **TypeScript**：类型安全
- **ESLint**：代码规范
- **Prettier**：代码格式化
- **Git Hooks**：提交前检查

---

## Project Scoping & Phased Development

### MVP Strategy & Philosophy

**MVP Approach:** Experience MVP - 交付核心用户体验（板块强弱可视化），让用户能够快速获取价值，同时保持功能精简可靠。

**MVP 哲学：**
- **功能精简**：只保留绝对核心功能，确保快速交付
- **体验优先**：核心用户流程必须流畅（查看热力图 → 筛选 → 排名）
- **质量保证**：宁可少做功能，也要保证稳定性
- **快速迭代**：2-3 个月 MVP，然后根据反馈快速改进

**资源需求：**
- **团队规模**：2-3 人（1 前端 + 1 后端 + 1 兼顾/DevOps）
- **技能要求**：React/Next.js、FastAPI、PostgreSQL、Docker
- **开发周期**：8-12 周 MVP

### MVP Feature Set (Phase 1)

**核心用户旅程支持：**
- Journey 1：投资者查看板块热力图并发现强势板块
- Journey 3：管理员初始化数据并日常维护

**必须具备的能力：**

**P0（发布前必须）：**
1. 用户认证系统（注册、登录、JWT）
2. 首页仪表板（板块热力图、TOP5 排名）
3. 板块和股票排名列表（基础表格）
4. 基础筛选功能（按板块类型）
5. 管理员控制台：
   - 数据初始化（板块、股票，60天回溯）
   - 按日期补齐数据
   - 任务进度监控
6. 免责声明和风险提示（所有页面）

**P1（发布后1个月内）：**
1. 板块详情页（成分股列表）
2. 数据验证和异常处理
3. 审计日志完善
4. 响应式适配（平板支持）

**MVP 不包含：**
- ❌ 用户关注列表
- ❌ 个股详情页
- ❌ 历史趋势图表
- ❌ 高级筛选
- ❌ 邮件提醒

### Post-MVP Features

**Phase 2 (Post-MVP - 发布后3-6个月)：**

**增强用户体验：**
1. 用户关注列表和个性化推荐
2. 板块详情页（成分股分析、强度趋势图）
3. 个股详情页（多周期强度明细、历史趋势）
4. 高级筛选（自定义条件组合）
5. 移动端优化

**数据扩展：**
1. 全市场板块覆盖（从15个扩展到50+）
2. 全A股股票覆盖（从750只扩展到5000+）
3. 历史数据回溯扩展到1年

**管理功能增强：**
1. 用户管理面板（管理员管理用户）
2. 数据质量监控仪表板
3. 定时任务调度（自动数据补齐）

**Phase 3 (Expansion - 发布后6-12个月)：**

**高级分析功能：**
1. 历史趋势图表（多周期对比）
2. 技术分析指标集成
3. 板块轮动预警
4. 邮件/消息提醒功能

**平台功能：**
1. API 开放（第三方集成）
2. 数据导出功能
3. 自定义指标配置

### Risk Mitigation Strategy

**技术风险：**

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| AkShare API 限流 | 数据获取失败 | 实现重试机制、添加请求间隔、考虑备用数据源 |
| 热力图性能 | 页面卡顿 | 数据分页、虚拟滚动、Web Worker 计算 |
| 异步任务稳定性 | 任务失败 | 基于数据库的任务队列、完善错误处理和日志 |

**市场风险：**

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| 用户需求不匹配 | 产品无人使用 | 快速 MVP 验证、收集早期用户反馈、灵活调整 |
| 数据准确性争议 | 信任度下降 | 明确免责声明、数据源标注、快速修正机制 |
| 竞品压力 | 用户流失 | 聚焦差异化（板块轮动）、简化用户体验 |

**资源风险：**

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| 开发时间超期 | 延迟上线 | 严格 MVP 范围控制、P2 功能全部后置 |
| 团队成员变动 | 进度停滞 | 代码文档化、知识共享、模块化设计 |
| 服务器成本 | 运营压力 | 使用经济型架构、优化数据库查询、按需扩展 |

**范围蔓延控制：**
- 严格的变更评估流程
- 新功能必须通过"是否对 MVP 至关重要"测试
- 所有 Phase 2+ 功能记录到待办列表，不分散 MVP 精力

### Development Timeline Estimate

**Phase 1 (MVP) - 8-12 周：**
- Epic 1: 基础架构（2 周）
- Epic 2: 用户认证（1 周）
- Epic 3: 数据引擎（3 周）
- Epic 4: 核心可视化（3 周）
- Epic 9: 管理员功能（2 周）
- 测试和修复（1 周）

**Phase 2 (Growth) - 3-6 个月：**
- Epic 5: 筛选和交互（1 个月）
- Epic 6: 详情页面（2 个月）
- 数据扩展和优化（持续）

**Phase 3 (Expansion) - 6-12 个月：**
- Epic 7: 高级分析（3 个月）
- 平台功能和 API（2 个月）
- 性能优化和扩展（持续）

---

## Functional Requirements

### 用户认证与授权

- **FR1**: 用户可以注册账户，提供用户名、密码和邮箱
- **FR2**: 用户可以使用用户名和密码登录系统
- **FR3**: 用户可以退出登录
- **FR4**: 系统可以验证用户身份并维持会话状态
- **FR5**: 系统可以区分普通用户和管理员角色
- **FR6**: 管理员可以访问数据管理功能
- **FR7**: 非管理员用户无法访问数据管理功能

### 数据可视化与分析

- **FR8**: 用户可以查看板块强度热力图，通过颜色编码表示强弱等级
- **FR9**: 用户可以查看板块强度排名列表
- **FR10**: 用户可以查看个股强度排名列表
- **FR11**: 用户可以按板块类型和行业分类筛选数据
- **FR12**: 用户可以查看强势板块 TOP5 列表
- **FR13**: 用户可以查看强势个股 TOP10 列表
- **FR14**: 用户可以查看市场强度指数
- **FR15**: 用户可以查看板块详情页，显示成分股列表
- **FR16**: 用户可以点击热力图区块进入对应板块详情页

### 数据刷新与时效性

- **FR17**: 系统可以自动每 5 分钟刷新数据
- **FR18**: 用户可以手动触发数据刷新
- **FR19**: 系统可以显示数据最后更新时间
- **FR20**: 系统可以在数据超过预设时间未更新时显示警告提示

### 合规与风险提示

- **FR21**: 用户在注册时必须确认已阅读风险提示
- **FR22**: 系统在每个数据展示页面显示风险提示声明
- **FR23**: 系统在首页底部显示免责声明链接
- **FR24**: 系统在所有数据页面标注数据来源
- **FR25**: 系统避免提供具体投资建议或买入/卖出推荐

### 管理员数据管理

- **FR26**: 管理员可以初始化所有板块数据，从 AkShare 拉取数据
- **FR27**: 管理员可以自定义数据回溯时间范围
- **FR28**: 管理员可以初始化所有股票数据
- **FR29**: 管理员可以按日期补齐数据
- **FR30**: 管理员可以按时间段拉取历史数据
- **FR31**: 管理员可以选择覆盖已有数据
- **FR32**: 系统可以异步执行数据初始化任务
- **FR33**: 系统可以显示数据任务的实时进度
- **FR34**: 系统可以显示任务状态（成功/失败/进行中）
- **FR35**: 管理员可以查看任务操作日志
- **FR36**: 系统可以记录所有管理员的操作到审计日志
- **FR37**: 系统支持任务失败后自动重试

### 数据质量与验证

- **FR38**: 系统可以对从 AkShare 获取的数据进行有效性检查
- **FR39**: 系统可以自动标记异常数据
- **FR40**: 系统可以将异常数据记录到日志
- **FR41**: 用户可以通过反馈通道报告数据异常
- **FR42**: 管理员可以查看并处理用户反馈的数据异常

### 用户界面与交互

- **FR43**: 系统支持桌面设备（1920x1080）显示
- **FR44**: 系统支持笔记本设备（1366x768）显示
- **FR45**: 系统支持平板设备（1024x768）显示
- **FR46**: 系统支持手机设备（375x667）基础显示
- **FR47**: 用户可以使用鼠标悬停在热力图区块上查看详细数据
- **FR48**: 系统可以在数据加载中显示加载状态提示
- **FR49**: 系统可以在 API 错误时显示友好提示和重试选项

### 用户偏好与设置

- **FR50**: 系统可以保存用户的筛选条件偏好
- **FR51**: 系统可以保存用户的排序偏好

---

## Non-Functional Requirements

### Performance

**响应时间要求：**
- **NFR-PERF-001**: 首页加载时间（FCP）< 1.5秒
- **NFR-PERF-002**: 可交互时间（TTI）< 3秒
- **NFR-PERF-003**: 路由切换 < 500ms
- **NFR-PERF-004**: API 响应时间（p95）< 200ms
- **NFR-PERF-005**: 热力图渲染（100个区块）< 500ms
- **NFR-PERF-006**: 表格渲染（1000行数据）< 1秒

**性能监控要求：**
- **NFR-PERF-007**: 系统应监控关键性能指标（Web Vitals）
- **NFR-PERF-008**: 性能指标应可被开发和运维团队查看

**性能降级策略：**
- **NFR-PERF-009**: 如果热力图数据量大，系统应使用分页或虚拟滚动
- **NFR-PERF-010**: 如果 API 响应慢，系统应显示加载提示而不是空白页

### Security

**身份验证与授权：**
- **NFR-SEC-001**: 系统应使用 JWT 进行用户身份验证
- **NFR-SEC-002**: 系统应使用 bcrypt 或类似算法哈希存储密码
- **NFR-SEC-003**: 管理员功能必须有基于角色的访问控制（RBAC）
- **NFR-SEC-004**: 非管理员用户无法访问管理员功能

**数据保护：**
- **NFR-SEC-005**: 用户密码不得以明文存储或传输
- **NFR-SEC-006**: 用户敏感信息（邮箱、偏好）应存储在加密数据库中
- **NFR-SEC-007**: 数据传输应使用 HTTPS/TLS 加密

**操作审计：**
- **NFR-SEC-008**: 系统应记录所有管理员操作到审计日志
- **NFR-SEC-009**: 审计日志应包含操作人、时间、操作内容、IP地址
- **NFR-SEC-010**: 审计日志应保留至少 6 个月
- **NFR-SEC-011**: 审计日志只能由管理员查看

**会话管理：**
- **NFR-SEC-012**: 用户会话应在合理时间后自动过期（建议7天）
- **NFR-SEC-013**: 系统应支持用户退出登录后立即失效会话

### Scalability

**用户规模：**
- **NFR-SCALE-001**: 系统应支持至少 10 个并发用户
- **NFR-SCALE-002**: 系统应支持至少 100 个注册用户
- **NFR-SCALE-003**: 系统架构应允许扩展到 100+ 并发用户

**数据规模：**
- **NFR-SCALE-004**: 系统应支持存储至少 1 年的历史数据
- **NFR-SCALE-005**: 系统应支持至少 5000 只股票的数据

**扩展性设计：**
- **NFR-SCALE-006**: 系统应设计为无状态架构，便于水平扩展
- **NFR-SCALE-007**: 数据库查询应优化，支持数据量增长时性能不下降超过 20%

**资源管理：**
- **NFR-SCALE-008**: 系统应使用数据库连接池，避免连接泄漏
- **NFR-SCALE-009**: 后台任务应有重试机制和超时控制

### Integration

**AkShare 数据源集成：**
- **NFR-INT-001**: 系统应能从 AkShare API 拉取股票和板块数据
- **NFR-INT-002**: 系统应处理 AkShare API 限流（添加请求间隔）
- **NFR-INT-003**: 系统应在 AkShare API 失败时自动重试（最多3次）
- **NFR-INT-004**: 系统应在 AkShare 数据异常时记录错误日志

**集成容错：**
- **NFR-INT-005**: 系统应能在 AkShare 服务不可用时显示友好提示
- **NFR-INT-006**: 系统应能缓存 API 响应，减少重复请求（5分钟缓存）

**数据质量：**
- **NFR-INT-007**: 系统应验证从 AkShare 获取的数据格式和范围
- **NFR-INT-008**: 系统应检测并标记异常数据（如价格异常、涨跌幅异常）

### Reliability

**可用性：**
- **NFR-REL-001**: 系统可用性目标 > 99%
- **NFR-REL-002**: 计划内维护窗口应提前通知用户（如适用）

**数据可靠性：**
- **NFR-REL-003**: 数据初始化任务成功率 > 95%
- **NFR-REL-004**: 系统应在数据更新失败时显示警告提示

**错误处理：**
- **NFR-REL-005**: 系统应在所有 API 错误时显示友好提示
- **NFR-REL-006**: 系统应在网络错误时提供重试选项
- **NFR-REL-007**: 系统应使用错误边界捕获前端崩溃

### Maintainability

**代码质量：**
- **NFR-MAINT-001**: 前端代码应使用 TypeScript 以确保类型安全
- **NFR-MAINT-002**: 代码应遵循 ESLint 和 Prettier 规范
- **NFR-MAINT-003**: 代码应包含适当的注释和文档

**部署：**
- **NFR-MAINT-004**: 系统应使用 Docker 容器化部署
- **NFR-MAINT-005**: 系统应支持通过 Docker Compose 一键启动
- **NFR-MAINT-006**: 部署时间应 < 10 分钟

**监控：**
- **NFR-MAINT-007**: 系统应记录应用日志和错误日志
- **NFR-MAINT-008**: 日志应包含足够信息用于问题排查

---

## 1. 目标和背景

### 目标
- 提供基于多周期均线的股票板块强度实时可视化
- 帮助投资者快速识别强势板块和个股
- 创建直观的板块强度热力图界面
- 通过排名和趋势分析提供可操作的洞察
- 为未来高级分析功能奠定基础
- 提供管理员工具用于数据初始化、更新和维护

### 背景
本项目旨在满足中国股票市场对量化板块分析工具的需求。传统技术分析通常关注个股，但板块轮动和强度模式提供了宝贵的市场洞察。系统使用多周期均线（5、10、20、30、60天）计算综合强度得分，提供板块级别和个股级别的分析。该工具将帮助投资者识别新兴趋势、监控板块轮动，并做出数据驱动的投资决策。

### 变更日志
| 日期 | 版本 | 描述 | 作者 |
|------|---------|-------------|--------|
| 2025-09-20 | v1.0 | 初始PRD创建 | PM代理 |
| 2025-12-24 | v1.1 | 转换为工作流格式 | PM代理 |
| 2025-12-24 | v1.2 | 添加管理员功能需求（数据初始化、更新、覆盖） | Mark |
| 2025-12-24 | v1.3 | 移除Redis依赖，改用数据库管理异步任务 | Mark |
| 2025-12-24 | v1.4 | 简化部署为单容器方案，移除独立Worker容器 | Mark |

## 2. 需求规格

### 功能需求 (FR)
1. **FR1**: 系统应显示带有颜色编码强度等级的板块热力图
2. **FR2**: 系统应计算并显示个股在多周期下的强度得分
3. **FR3**: 系统应提供按强度排名的板块和个股列表
4. **FR4**: 系统应支持按板块类型和行业分类进行筛选
5. **FR5**: 系统应允许选择时间周期（今日、本周、本月）
6. **FR6**: 系统应提供包含成分股分析的详细板块页面
7. **FR7**: 系统应提供包含多周期强度明细的详细个股页面
8. **FR8**: 系统应提供历史强度趋势图表功能

### 管理员功能需求 (AFR)
1. **AFR1**: 系统应提供管理员角色和权限控制，仅管理员可访问数据管理功能
2. **AFR2**: 系统应支持初始化所有板块数据（从 AkShare 拉取，支持自定义回溯时间）
3. **AFR3**: 系统应支持初始化所有股票数据（从 AkShare 拉取，支持自定义回溯时间）
4. **AFR4**: 系统应支持按日期补齐数据（用于收盘后数据补全）
5. **AFR5**: 系统应支持按时间段拉取历史数据
6. **AFR6**: 系统应支持覆盖已有数据（用于数据修正场景）
7. **AFR7**: 数据初始化任务应异步执行，并提供实时进度显示
8. **AFR8**: 系统应显示任务状态（成功/失败/进行中）和详细日志

### 非功能需求 (NFR)
1. **NFR1**: 系统对用户交互的响应时间应在200ms内
2. **NFR2**: 数据可视化应在1秒内渲染完成
3. **NFR3**: 系统应支持多用户并发访问
4. **NFR4**: 应通过适当验证保持数据准确性
5. **NFR5**: UI应具有响应式设计，支持桌面和移动设备
6. **NFR6**: 管理员功能必须有严格的权限控制和操作审计日志
7. **NFR7**: 异步数据任务应支持取消操作和错误重试机制

## 3. 用户界面设计目标

### 整体UX愿景
创建一个专业、直观的金融分析界面，专注于数据可视化和快速洞察。界面应该让用户能够一目了然地识别强势板块和个股，同时提供深入的细节分析能力。

### 关键交互模式
- **点击探索**: 用户可以通过点击热力图区块直接进入板块详情
- **悬停预览**: 鼠标悬停时显示详细数据提示
- **快速筛选**: 侧边栏或顶部提供直观的筛选控件
- **时间轴控制**: 简单的时间周期选择器

### 核心屏幕和视图
1. **首页仪表板**: 板块热力图、强势板块TOP5、强势个股TOP10、市场强度指数
2. **板块详情页**: 板块强度趋势图、成分股列表、板块内个股排名、基本信息
3. **个股详情页**: 多周期强度明细、历史趋势、相对板块表现、个股信息
4. **排名列表页**: 可排序的板块和个股排名表格
5. **管理员控制台** (仅管理员):
   - 数据初始化面板：板块数据初始化、股票数据初始化、回溯时间选择
   - 数据更新面板：按日期补齐、按时间段拉取、数据覆盖选项
   - 任务监控面板：实时进度显示、任务状态列表、操作日志查看
   - 用户管理面板：用户列表、角色管理、权限分配

### 品牌风格
采用简洁专业的金融界面风格，使用中性色调为主，配合清晰的数据可视化颜色编码（红-橙-黄-绿表示强度等级）。

### 目标设备和平台: Web响应式
支持PC浏览器完整功能和手机浏览器基础功能，确保主要功能跨设备可用。

## 4. 技术假设

### 仓库结构: Monorepo
采用单仓库结构管理前端Next.js和后端FastAPI代码，统一Docker化部署。

### 服务架构
- **前端**: Next.js + TypeScript + Tailwind CSS
- **后端**: Python + FastAPI + SQLAlchemy + asyncpg
- **数据库**: PostgreSQL 13+ 用于持久化存储
- **数据源**: AkShare 提供实时股票数据
- **异步任务**: 基于数据库的任务队列（PostgreSQL 存储任务状态），后台线程在 FastAPI 进程内运行，轮询并执行任务
- **权限系统**: 基于角色的访问控制（RBAC）实现管理员权限隔离

### 测试要求
采用完整的测试金字塔策略：
- **前端测试**: Jest + React Testing Library
- **后端测试**: pytest + 异步测试
- **API测试**: 全面的接口测试覆盖

### 部署方案
- **Docker化**: 多阶段Docker构建，优化镜像大小
- **编排工具**: Docker Compose用于开发和生产环境
- **反向代理**: Nginx作为反向代理
- **数据库容器**: PostgreSQL容器化部署
- **数据持久化**: Docker volumes用于数据库数据持久化
- **异步任务**: 在 FastAPI 主进程内运行后台线程，从数据库任务表轮询并执行任务
- **容器架构**: 仅 3 个容器（frontend + backend + postgres + nginx），最小化依赖
- **基本健康检查**: 容器基础健康检查配置
- **资源管理**: 适当的Docker资源限制配置

## 5. Epic规划

### Epic 1: 基础架构与核心服务
建立项目基础架构，包括Docker化部署、数据库设置、核心API服务和基础前端框架。

### Epic 2: 用户认证系统
建立完整的用户认证和授权系统，提供安全的用户管理功能，为后续个性化功能提供基础。

### Epic 3: 数据采集和处理引擎
实现AkShare数据接入、数据清洗转换、自定义多周期强度计算算法和数据缓存机制。

### Epic 4: 板块强度可视化核心功能
实现板块热力图、强度排名列表、基础筛选功能和基础响应式适配。

### Epic 5: 筛选和交互功能
实现板块和个股筛选、时间周期选择、高级交互功能。

### Epic 6: 详情页面与用户关注功能
实现板块详情页、个股详情页、历史趋势图表和多周期分析对比功能，同时实现用户关注列表。

### Epic 7: 高级分析功能
实现历史趋势图表、技术分析指标和专业分析工具。

### Epic 8: 性能优化和部署
完成系统性能优化、生产环境部署和监控配置，确保系统稳定可靠运行。

### Epic 9: 管理员功能系统
实现管理员数据管理功能，包括角色权限控制、数据初始化（板块和股票）、数据更新和补齐、异步任务管理、进度监控和操作日志。

#### Epic 9 子任务：
- **9.1 管理员角色和权限**：实现基于角色的访问控制（RBAC），区分管理员和普通用户权限
- **9.2 数据初始化功能**：支持从 AkShare 拉取板块和股票历史数据，可自定义回溯时间
- **9.3 数据更新和补齐**：支持按日期补齐数据、按时间段拉取历史数据、数据覆盖
- **9.4 异步任务系统**：实现基于数据库的轻量级任务队列，在 FastAPI 进程内运行后台线程轮询任务表，支持进度跟踪、任务取消和重试
- **9.5 管理员界面**：创建数据管理面板、任务监控面板、用户管理面板
- **9.6 操作审计**：记录管理员操作日志，支持审计和追溯

## 6. 下一步

### UX专家提示
基于此PRD文档，请设计直观专业的金融数据可视化界面，重点关注热力图交互和数据分析流程。

### 架构师提示
基于此PRD文档，请设计可扩展的技术架构，特别关注数据流水线性能和高并发处理能力。

---
*文档版本: 1.4*
*最后更新: 2025-12-24*
