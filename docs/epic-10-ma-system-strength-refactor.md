# 史诗10: 基于均线系统的强度计算重构

## 概述
重构现有强度计算系统，采用全新的基于均线系统的两维度计算方法（价格位置 + 均线排列），简化计算逻辑，提高准确性。

## 业务目标
- 简化强度计算逻辑，从多指标降维到两大核心维度
- 提高强度评分与实际走势的匹配度
- 实现个股和板块的统一计算方法
- 支持强度历史趋势追踪
- 建立可扩展的权重配置系统

## 功能范围
- 基于均线系统的价格位置评分（8条均线）
- 基于均线排列的趋势评分
- 短中长期强度分类
- 强度历史数据存储和查询
- 排名和百分位计算
- 自定义权重配置（预留）

## 验收标准
1. ✅ 实现8条均线（MA5/10/20/30/60/90/120/240）的综合计算
2. ✅ 价格位置得分算法正确实现
3. ✅ 均线排列得分算法正确实现
4. ✅ 综合强度得分 = (价格位置 + 均线排列) / 2
5. ✅ 强度等级正确划分为10级（S+/S/A+/A/B+/B/C+/C/D+/D）
6. ✅ 数据库表结构优化，支持个股和板块
7. ✅ 历史强度数据可查询和展示
8. ✅ 排名计算准确高效

## 技术约束
- 基于现有 `moving_average_data` 表读取均线数据
- 扩展现有 `strength_scores` 表结构
- 使用 Alembic 生成数据库迁移脚本
- 计算性能：单只股票 < 100ms，1000只股票 < 5分钟
- 使用现有 `daily_market_data` 表作为数据源

## 依赖关系
- 依赖史诗3完成（现有数据采集和处理引擎）
- 依赖现有数据表（moving_average_data, daily_market_data, strength_scores）

## 风险评估
- **中风险**: 数据库迁移可能影响现有功能
- **中风险**: 计算结果与旧方法差异可能导致用户困惑
- **低风险**: 新算法的计算性能

## 优先级: 高
## 预估工作量: 中
## 状态: 待开始

---

## 变更日志
| 日期 | 版本 | 描述 | 作者 |
|------|------|------|------|
| 2024-12-28 | v1.0 | 初始史诗定义 | Claude |

## 包含的 Stories

### Story 10.1: 数据库表结构优化
- 扩展 `strength_scores` 表，添加新字段
- 通过 Alembic 生成迁移脚本
- 数据迁移和验证

### Story 10.2: 均线系统强度计算引擎
- 实现价格位置得分计算
- 实现均线排列得分计算
- 实现短中长期强度分类
- 实现综合强度得分计算

### Story 10.3: 强度数据服务
- 实现个股强度计算服务
- 实现批量计算功能
- 实现排名计算
- 实现历史数据查询

### Story 10.4: 强度 API 接口
- 获取单个股票/板块强度
- 获取强度排名
- 获取强度历史曲线
- 获取强度统计信息

### Story 10.5: 强度历史趋势分析
- 实现历史数据存储
- 实现趋势特征识别
- 实现统计分析功能
- 实现对比分析功能

### Story 10.6: 自定义权重配置（可选）
- 实现权重配置管理
- 实现自定义配置创建
- 实现配置导入导出
- 实现配置推荐功能
