# 股票市场板块强弱指标系统 - 数据库设计文档

## 📋 项目概述

本系统是一个基于移动平均线系统的股票市场板块强弱指标Web应用，通过5、10、20、30、60、120、250日等可配置均线周期来量化评估股票和板块的强弱程度。

## 🗃️ 数据库设计

### PostgreSQL 表结构

#### 1. 股票基本信息表 (stocks)
```sql
CREATE TABLE stocks (
    id SERIAL PRIMARY KEY,
    symbol VARCHAR(10) NOT NULL UNIQUE,      -- 股票代码
    name VARCHAR(100) NOT NULL               -- 股票名称
);
```

#### 2. 板块信息表 (sectors)
```sql
CREATE TABLE sectors (
    id SERIAL PRIMARY KEY,
    sector_code VARCHAR(50) NOT NULL UNIQUE, -- 板块代码
    sector_name VARCHAR(100) NOT NULL,       -- 板块名称
    sector_type VARCHAR(20) DEFAULT 'industry' -- industry/concept
);
```

#### 3. 股票-板块关联表 (stock_sectors)
```sql
CREATE TABLE stock_sectors (
    id SERIAL PRIMARY KEY,
    stock_id INTEGER NOT NULL,               -- 股票ID
    sector_id INTEGER NOT NULL,              -- 板块ID
    UNIQUE(stock_id, sector_id)
);
```

#### 4. 日线行情数据表 (daily_prices)
```sql
CREATE TABLE daily_prices (
    id SERIAL PRIMARY KEY,
    stock_id INTEGER NOT NULL,               -- 股票ID
    trade_date DATE NOT NULL,                -- 交易日期
    open_price DECIMAL(10, 4),               -- 开盘价
    high_price DECIMAL(10, 4),               -- 最高价
    low_price DECIMAL(10, 4),                -- 最低价
    close_price DECIMAL(10, 4),              -- 收盘价
    volume BIGINT,                           -- 成交量
    turnover DECIMAL(15, 2),                 -- 成交额
    UNIQUE(stock_id, trade_date)
);
```

#### 5. 均线配置表 (ma_configurations)
```sql
CREATE TABLE ma_configurations (
    id SERIAL PRIMARY KEY,
    period INTEGER NOT NULL UNIQUE,          -- 均线周期
    description VARCHAR(50),                 -- 描述
    is_active BOOLEAN DEFAULT TRUE,          -- 是否启用
    weight DECIMAL(5,2) DEFAULT 1.0          -- 权重系数
);
```

#### 6. 均线数据表 (moving_averages)
```sql
CREATE TABLE moving_averages (
    id SERIAL PRIMARY KEY,
    target_id INTEGER NOT NULL,              -- 目标ID（股票ID或板块ID）
    target_type VARCHAR(10) NOT NULL,        -- 目标类型: 'stock'或'sector'
    ma_config_id INTEGER NOT NULL,           -- 均线配置ID
    trade_date DATE NOT NULL,
    ma_value DECIMAL(10, 4) NOT NULL,        -- 均线值
    UNIQUE(target_id, target_type, ma_config_id, trade_date)
);
```

#### 7. 强度指标表 (strength_indicators)
```sql
CREATE TABLE strength_indicators (
    id SERIAL PRIMARY KEY,
    target_id INTEGER NOT NULL,              -- 目标ID（股票ID或板块ID）
    target_type VARCHAR(10) NOT NULL,        -- 目标类型: 'stock'或'sector'
    ma_config_id INTEGER NOT NULL,           -- 均线配置ID
    trade_date DATE NOT NULL,
    score SMALLINT,                          -- 该均线得分
    position_ratio DECIMAL(8,4),             -- 价格相对位置
    is_above BOOLEAN,                        -- 是否在均线上方
    UNIQUE(target_id, target_type, ma_config_id, trade_date)
);
```

## 📊 索引设计

### 股票表索引
- `idx_stocks_symbol`: 股票代码索引

### 板块表索引
- `idx_sectors_type`: 板块类型索引

### 关联表索引
- `idx_stock_sectors_stock`: 股票ID索引
- `idx_stock_sectors_sector`: 板块ID索引

### 行情数据索引
- `idx_daily_prices_date`: 交易日期索引
- `idx_daily_prices_stock_date`: 股票+日期复合索引

### 均线配置索引
- `idx_ma_config_period`: 均线周期索引

### 均线数据索引
- `idx_moving_avgs_date`: 交易日期索引
- `idx_moving_avgs_target`: 目标ID+类型索引
- `idx_moving_avgs_config`: 配置ID索引
- `idx_moving_avgs_type_config`: 类型+配置复合索引

### 强度指标索引
- `idx_strength_date`: 交易日期索引
- `idx_strength_target`: 目标ID+类型索引
- `idx_strength_config`: 配置ID索引
- `idx_strength_type_config`: 类型+配置复合索引

## 🔧 设计特点

### 1. 无外键约束
- 所有外键约束由应用代码保证数据一致性
- 提高数据插入性能
- 简化数据库维护

### 2. 均线可配置化
- 支持任意均线周期配置
- 每个周期可单独设置权重
- 灵活启用/禁用不同周期

### 3. 统一数据模型
- `target_type`字段区分股票和板块数据
- 相同的表结构存储不同类型实体的指标
- 简化查询逻辑

### 4. 数据完整性
- 唯一约束防止重复数据
- 合理的字段长度和精度设置
- 明确的数据类型选择

## 📈 初始化数据

### 预置均线配置
```sql
INSERT INTO ma_configurations (period, description, weight) VALUES
(5, '5日均线', 1.0),
(10, '10日均线', 1.2),
(20, '20日均线', 1.5),
(30, '30日均线', 1.8),
(60, '60日均线', 2.0),
(120, '120日均线', 2.2),
(250, '250日均线', 2.5);
```

## 🎯 应用场景

### 股票强度分析
- 单个股票在多周期均线下的表现评估
- 量化股价相对于各均线的位置关系
- 生成综合强度得分

### 板块强度分析
- 板块内股票强度的聚合分析
- 板块间强度对比
- 板块轮动趋势识别

### 可视化展示
- 热力图显示板块强度分布
- 趋势图表展示强度变化
- 排名列表显示强势股票/板块

## 🔄 数据流设计

1. **数据获取**: 通过AkShare获取A股市场数据
2. **数据处理**: 计算各周期移动平均线
3. **强度计算**: 根据价格与均线位置计算得分
4. **结果存储**: 保存计算结果到数据库
5. **数据展示**: 通过Web界面可视化展示

---
*文档版本: 1.0*
*最后更新: 2024-01-20*